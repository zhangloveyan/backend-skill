---
name: proj-sync-doc
description: 基于 Git 提交和代码变更点同步需求/技术文档并补单元测试。用于修复或紧急改动后补文档、对齐代码与文档时使用。
---

# 文档与单测同步

## 触发词

- "同步文档"
- "根据 git 提交补文档"
- "对齐文档"
- "补单元测试"

---

## 执行流程

```
Step 0: 选择范围 → Step 1: 提取变更 → Step 2: 归类影响 → Step 3: 用户确认 → Step 4: 同步需求/技术文档 → Step 5: 同步单元测试 → Step 6: 总结
```

---

## 强制规则

- 发现文档与现有代码不一致时，以现有代码业务逻辑为准
- 提取改动点后必须与用户确认，未确认不得修改文档

---

## Step 0: 选择范围

- 优先让用户指定提交范围或提交 ID
- 未指定时，先展示最近提交列表并询问范围
- 允许选择“未提交变更”作为范围

---

## Step 1: 提取变更

- 获取提交、文件列表、关键 diff
- 聚焦业务逻辑、接口、数据结构相关变更

---

## Step 2: 归类影响

- 需求文档：用户可感知行为、流程、功能边界变化
- 技术文档：接口入参/出参/错误码、数据结构、核心逻辑变化
- 单元测试：Service/Controller/Mapper 等逻辑调整需补测

---

## Step 3: 用户确认

- 输出“改动点清单”并请求用户确认
- 用户未确认：停止文档更新，仅保留清单

```markdown
## 改动点清单（待确认）
1. {改动点}（涉及：{文件/模块}）
2. ...
```

---

## Step 4: 同步需求/技术文档

- 仅在用户确认后执行
- 遵循项目文档命名与更新规则
- 按影响点原地更新 `docs/req` 与 `docs/design`

---

## Step 5: 同步单元测试

- 按变更点补充/调整单元测试
- 优先覆盖新增分支、边界条件、异常路径

---

## Step 6: 总结

- 列出已更新的文档与测试文件
- 提示用户检查与确认

---

## 命令模板（可选）

```bash
# 最近提交
git log -n 10 --oneline

# 单个提交变更
git show <hash> --stat
git show <hash>

# 提交范围对比
git diff --name-status <from>..<to>
git diff <from>..<to>

# 未提交变更
git diff --name-status
git diff
```
