---
name: analyze
description: 需求分析、澄清、方案设计的完整流程。用于用户提出新功能需求、需要设计新模块、复杂功能开发前的规划。
---

# 需求分析

## 执行流程

```
Step 1: 需求理解 → Step 2: 规模判断 → Step 3: 信息收集
    ↓
Step 4: 方案设计 → Step 5: 用户确认 → Step 6: 生成任务
```

---

## Step 1: 需求理解

从用户描述中提取：

1. **功能目标** - 要实现什么
2. **使用角色** - 谁来用
3. **涉及模块** - 影响哪些模块
4. **关键操作** - 核心功能点

---

## Step 2: 规模判断

| 规模 | 特征 | 后续流程 |
|------|------|----------|
| 简单 | 改字段、加接口、改配置 | 跳过方案文档，直接开发 |
| 中等 | 新模块、独立功能 | 简化方案，可口头确认 |
| 复杂 | 跨模块、架构调整、核心流程 | 完整方案文档 |

**判断依据：**
- 涉及 1 个文件 → 简单
- 涉及 1 个模块（多文件） → 中等
- 涉及多个模块 → 复杂

---

## Step 3: 信息收集（澄清问题）

### 功能层面
- 使用角色是谁？（管理员/普通用户/访客）
- 需要哪些端？（Web后台/App/小程序/开放接口）
- 核心操作有哪些？（增删改查/审批/导出/统计...）
- 有无状态流转？
- 有无权限控制？

### 数据层面
- 需要哪些字段？
- 哪些字段必填？
- 是否关联其他表？

### 业务规则
- 有无业务校验规则？
- 有无特殊计算逻辑？
- 有无第三方对接？

**注意：** 不要一次问太多，根据需求复杂度逐步澄清。

---

## Step 4: 方案设计

### 简单需求
口头说明改动点即可，无需文档。

### 中等/复杂需求
输出方案文档，格式如下：

```markdown
# {功能名称} 实现方案

## 1. 功能概述
{一句话描述功能目标}

## 2. 数据库设计
### 表结构
**表名：** `{table_name}`

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | BIGINT | 是 | 主键 |

### 索引设计
| 索引名 | 字段 | 类型 | 说明 |
|--------|------|------|------|

## 3. 接口设计
| 端 | 方法 | 路径 | 说明 |
|----|------|------|------|
| Web | GET | /{project}/web/v1/{module} | 列表/分页查询 |
| Web | GET | /{project}/web/v1/{module}/{id} | 详情 |
| Web | POST | /{project}/web/v1/{module} | 创建 |
| Web | PUT | /{project}/web/v1/{module}/{id} | 更新 |
| Web | DELETE | /{project}/web/v1/{module}/{id} | 删除 |

## 4. 业务规则
- 规则1
- 规则2

## 5. 涉及文件
### 新增文件
- `{module}/entity/{Entity}.java`
- `{module}/mapper/{Entity}Mapper.java`
- `{module}/service/{Entity}Service.java`
- `{module}/service/impl/{Entity}ServiceImpl.java`
- `{module}/model/request/{Entity}CreateRequest.java`
- `{module}/model/response/{Entity}Response.java`
- `admin/controller/{Entity}Controller.java`
```

---

## Step 5: 用户确认

向用户展示方案，询问：
1. 功能范围是否正确？
2. 字段设计是否完整？
3. 接口设计是否满足需求？
4. 有无需要调整的地方？

**用户反馈处理：**
- 确认通过 → 进入 Step 6
- 需要修改 → 调整方案后再次确认
- 取消需求 → 结束流程

---

## Step 6: 生成任务

1. **保存方案文档**（中等/复杂需求）：`docs/方案/{功能名称}.md`
2. **生成任务清单**：调用 `/task` 创建任务
3. **开始开发**：按顺序 SQL → Entity → Mapper → Service → DTO → Controller

---

## 注意事项

1. **不要假设** - 不确定的点必须问用户
2. **不要过度设计** - 按用户实际需求来，不主动加功能
3. **保持简洁** - 简单需求不要搞复杂
4. **命名规范** - 参考 CLAUDE.md「命名规范」章节
5. **接口规范** - 参考 CLAUDE.md「接口规范」章节
