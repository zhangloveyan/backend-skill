# 公共类规范

> 本文档定义项目通用公共类的实现规范和使用方式。

## 文档版本

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-01-06 | 初始版本 |

---

## 1. 统一响应类 R

### 1.1 实现

```java
package com.{company}.{project}.common.core;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serializable;

/**
 * 统一API响应结果
 */
@Data
@Schema(description = "统一响应结果")
public class R<T> implements Serializable {

    private static final long serialVersionUID = 1L;

    @Schema(description = "状态码，0表示成功")
    private int code;

    @Schema(description = "提示信息")
    private String message;

    @Schema(description = "响应数据")
    private T data;

    @Schema(description = "时间戳")
    private long timestamp;

    public R() {
        this.timestamp = System.currentTimeMillis();
    }

    public static <T> R<T> success() {
        R<T> r = new R<>();
        r.setCode(0);
        r.setMessage("成功");
        return r;
    }

    public static <T> R<T> success(T data) {
        R<T> r = new R<>();
        r.setCode(0);
        r.setMessage("成功");
        r.setData(data);
        return r;
    }

    public static <T> R<T> success(String message, T data) {
        R<T> r = new R<>();
        r.setCode(0);
        r.setMessage(message);
        r.setData(data);
        return r;
    }

    public static <T> R<T> fail(int code, String message) {
        R<T> r = new R<>();
        r.setCode(code);
        r.setMessage(message);
        return r;
    }

    public static <T> R<T> fail(ErrorCode errorCode) {
        R<T> r = new R<>();
        r.setCode(errorCode.getCode());
        r.setMessage(errorCode.getMessage());
        return r;
    }

    public static <T> R<T> fail(ErrorCode errorCode, String message) {
        R<T> r = new R<>();
        r.setCode(errorCode.getCode());
        r.setMessage(message);
        return r;
    }

    public boolean isSuccess() {
        return this.code == 0;
    }
}
```

---

## 2. 错误码枚举 ErrorCode

### 2.1 实现

```java
package com.{company}.{project}.common.core;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 错误码枚举
 *
 * 错误码规范：
 * - 0: 成功
 * - 1xxxx: 认证/权限
 * - 2xxxx: 用户模块
 * - 3xxxx: 业务模块A（按需定义）
 * - 4xxxx: 业务模块B（按需定义）
 * - 9xxxx: 系统/通用
 */
@Getter
@AllArgsConstructor
public enum ErrorCode {

    // ========== 成功 ==========
    SUCCESS(0, "成功"),

    // ========== 认证/权限 1xxxx ==========
    UNAUTHORIZED(10001, "未登录"),
    TOKEN_EXPIRED(10002, "Token已过期"),
    FORBIDDEN(10003, "无权限"),
    ACCOUNT_DISABLED(10004, "账号被禁用"),
    TOKEN_INVALID(10005, "Token无效"),
    CAPTCHA_ERROR(10006, "验证码错误"),
    CAPTCHA_EXPIRED(10007, "验证码已过期"),
    
    // ========== 系统/通用 9xxxx ==========
    PARAM_ERROR(90001, "参数错误"),
    PARAM_MISSING(90002, "参数缺失"),
    PARAM_FORMAT_ERROR(90003, "参数格式错误"),
    NOT_FOUND(90004, "资源不存在"),
    DATA_EXIST(90005, "数据已存在"),
    TOO_MANY_REQUESTS(90006, "请求过于频繁"),
    OPERATION_FAILED(90007, "操作失败"),
    DATA_NOT_EXIST(90008, "数据不存在"),
    METHOD_NOT_ALLOWED(90009, "请求方法不允许"),
    SYSTEM_ERROR(99999, "系统错误"),

    // ========== 用户模块 2xxxx ==========
    USER_NOT_FOUND(20001, "用户不存在"),
    USER_ALREADY_EXISTS(20002, "用户已存在"),
    USER_DISABLED(20003, "用户已禁用"),
    USER_PASSWORD_ERROR(20004, "密码错误"),

    // ========== 业务模块（按需扩展） ==========
    ;

    private final int code;
    private final String message;
}
```

---

## 3. 业务异常 BusinessException

### 3.1 实现

```java
package com.{company}.{project}.common.exception;

import com.{company}.{project}.common.core.ErrorCode;
import lombok.Getter;

/**
 * 业务异常
 */
@Getter
public class BusinessException extends RuntimeException {

    private final int code;
    private final String message;

    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.code = errorCode.getCode();
        this.message = errorCode.getMessage();
    }

    public BusinessException(ErrorCode errorCode, String message) {
        super(message);
        this.code = errorCode.getCode();
        this.message = message;
    }

    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
}
```

### 3.2 使用方式

```java
// 推荐：使用 ErrorCode
throw new BusinessException(ErrorCode.NOT_FOUND);
throw new BusinessException(ErrorCode.PARAM_ERROR, "用户名不能为空");

// 不推荐：直接使用数字
throw new BusinessException(90001, "参数错误");  // 避免
```

---

## 4. 全局异常处理器

### 4.1 实现

```java
package com.{company}.{project}.common.exception;

import com.{company}.{project}.common.core.ErrorCode;
import com.{company}.{project}.common.core.R;
import jakarta.servlet.http.HttpServletRequest;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpStatus;
import org.springframework.validation.BindException;
import org.springframework.validation.FieldError;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.web.servlet.NoHandlerFoundException;

/**
 * 全局异常处理器
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * 业务异常
     */
    @ExceptionHandler(BusinessException.class)
    public R<Void> handleBusinessException(BusinessException e, HttpServletRequest request) {
        log.warn("业务异常: uri={}, code={}, message={}", request.getRequestURI(), e.getCode(), e.getMessage());
        return R.fail(e.getCode(), e.getMessage());
    }

    /**
     * 参数校验异常 - @RequestBody
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleMethodArgumentNotValidException(MethodArgumentNotValidException e) {
        FieldError fieldError = e.getBindingResult().getFieldError();
        String message = fieldError != null ? fieldError.getDefaultMessage() : "参数校验失败";
        log.warn("参数校验失败: {}", message);
        return R.fail(ErrorCode.PARAM_ERROR, message);
    }

    /**
     * 参数校验异常 - @RequestParam
     */
    @ExceptionHandler(BindException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public R<Void> handleBindException(BindException e) {
        FieldError fieldError = e.getBindingResult().getFieldError();
        String message = fieldError != null ? fieldError.getDefaultMessage() : "参数绑定失败";
        log.warn("参数绑定失败: {}", message);
        return R.fail(ErrorCode.PARAM_ERROR, message);
    }

    /**
     * 请求方法不支持
     */
    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    @ResponseStatus(HttpStatus.METHOD_NOT_ALLOWED)
    public R<Void> handleHttpRequestMethodNotSupportedException(HttpRequestMethodNotSupportedException e) {
        log.warn("请求方法不支持: {}", e.getMethod());
        return R.fail(ErrorCode.METHOD_NOT_ALLOWED);
    }

    /**
     * 404 异常
     */
    @ExceptionHandler(NoHandlerFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public R<Void> handleNoHandlerFoundException(NoHandlerFoundException e) {
        log.warn("接口不存在: {}", e.getRequestURL());
        return R.fail(ErrorCode.NOT_FOUND, "接口不存在");
    }

    /**
     * 其他异常
     */
    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    public R<Void> handleException(Exception e, HttpServletRequest request) {
        log.error("系统异常: uri={}", request.getRequestURI(), e);
        return R.fail(ErrorCode.SYSTEM_ERROR);
    }
}
```

---

## 5. 全局常量 Constants

### 5.1 实现

```java
package com.{company}.{project}.common.constant;

/**
 * 全局常量（魔法值统一管理）
 */
public class Constants {

    private Constants() {}

    // ========== 通用状态 ==========
    public static final int STATUS_ENABLE = 1;
    public static final int STATUS_DISABLE = 0;
    public static final int DEL_FLAG_NORMAL = 0;
    public static final int DEL_FLAG_DELETED = 1;
    public static final int YES = 1;
    public static final int NO = 0;

    // ========== 分页 ==========
    public static final int DEFAULT_PAGE_NUM = 1;
    public static final int DEFAULT_PAGE_SIZE = 10;
    public static final int MAX_PAGE_SIZE = 100;

    // ========== 缓存时间（秒） ==========
    public static final long CACHE_1_MINUTE = 60L;
    public static final long CACHE_5_MINUTES = 300L;
    public static final long CACHE_10_MINUTES = 600L;
    public static final long CACHE_30_MINUTES = 1800L;
    public static final long CACHE_1_HOUR = 3600L;
    public static final long CACHE_2_HOURS = 7200L;
    public static final long CACHE_1_DAY = 86400L;
    public static final long CACHE_7_DAYS = 604800L;

    // ========== 认证相关 ==========
    public static final String TOKEN_HEADER = "Authorization";
    public static final String TOKEN_PREFIX = "Bearer ";

    // ========== 日期格式 ==========
    public static final String DATE_FORMAT = "yyyy-MM-dd";
    public static final String TIME_FORMAT = "HH:mm:ss";
    public static final String DATETIME_FORMAT = "yyyy-MM-dd HH:mm:ss";

    // ========== 字符集 ==========
    public static final String UTF8 = "UTF-8";

    // ========== 内容类型 ==========
    public static final String CONTENT_TYPE_JSON = "application/json;charset=UTF-8";
    public static final String CONTENT_TYPE_FORM = "application/x-www-form-urlencoded";
}
```

---

## 6. Redis 工具类

### 6.1 RedisKeys 常量

```java
package com.{company}.{project}.common.redis;

/**
 * Redis Key 常量
 *
 * 命名规范: {project}:{module}:{entity}:{id}
 */
public class RedisKeys {

    private RedisKeys() {}

    /** Key 前缀 */
    private static final String PREFIX = "{project}:";

    // ========== 用户模块 ==========
    /** 用户信息缓存 */
    public static final String USER_INFO = PREFIX + "user:info:";
    /** 用户Token */
    public static final String USER_TOKEN = PREFIX + "user:token:";

    // ========== 验证码 ==========
    /** 图形验证码 */
    public static final String CAPTCHA = PREFIX + "captcha:";
    /** 短信验证码 */
    public static final String SMS_CODE = PREFIX + "sms:code:";

    // ========== 分布式锁 ==========
    /** 锁前缀 */
    public static final String LOCK = PREFIX + "lock:";

    /**
     * 构建完整Key
     */
    public static String buildKey(String prefix, Object... parts) {
        StringBuilder sb = new StringBuilder(prefix);
        for (Object part : parts) {
            sb.append(part).append(":");
        }
        return sb.substring(0, sb.length() - 1);
    }
}
```

### 6.2 RedisUtils 工具类

```java
package com.{company}.{project}.common.redis;

import lombok.RequiredArgsConstructor;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.stereotype.Component;
import java.util.Collection;
import java.util.concurrent.TimeUnit;

/**
 * Redis 工具类
 */
@Component
@RequiredArgsConstructor
public class RedisUtils {

    private final StringRedisTemplate redisTemplate;

    // ========== String 操作 ==========

    public void set(String key, String value) {
        redisTemplate.opsForValue().set(key, value);
    }

    public void set(String key, String value, long timeout) {
        redisTemplate.opsForValue().set(key, value, timeout, TimeUnit.SECONDS);
    }

    public String get(String key) {
        return redisTemplate.opsForValue().get(key);
    }

    public Boolean delete(String key) {
        return redisTemplate.delete(key);
    }

    public Long delete(Collection<String> keys) {
        return redisTemplate.delete(keys);
    }

    // ========== 过期时间 ==========

    public Boolean expire(String key, long timeout) {
        return redisTemplate.expire(key, timeout, TimeUnit.SECONDS);
    }

    public Long getExpire(String key) {
        return redisTemplate.getExpire(key, TimeUnit.SECONDS);
    }

    public Boolean hasKey(String key) {
        return redisTemplate.hasKey(key);
    }

    // ========== 自增/自减 ==========

    public Long increment(String key) {
        return redisTemplate.opsForValue().increment(key);
    }

    public Long increment(String key, long delta) {
        return redisTemplate.opsForValue().increment(key, delta);
    }

    public Long decrement(String key) {
        return redisTemplate.opsForValue().decrement(key);
    }

    // ========== 分布式锁 ==========

    public Boolean tryLock(String key, String value, long timeout) {
        return redisTemplate.opsForValue().setIfAbsent(key, value, timeout, TimeUnit.SECONDS);
    }

    public Boolean unlock(String key, String value) {
        String currentValue = redisTemplate.opsForValue().get(key);
        if (value.equals(currentValue)) {
            return redisTemplate.delete(key);
        }
        return false;
    }
}
```

---

## 7. RestTemplate 工具类

### 7.1 实现

```java
package com.{company}.{project}.common.util;

import com.{company}.{project}.common.core.R;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.*;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestTemplate;
import java.util.Map;

/**
 * RestTemplate 工具类
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class RestTemplateUtils {

    private final RestTemplate restTemplate;
    private final ObjectMapper objectMapper;

    /**
     * GET 请求
     */
    public <T> T get(String url, Class<T> responseType) {
        return restTemplate.getForObject(url, responseType);
    }

    /**
     * GET 请求（带参数）
     */
    public <T> T get(String url, Class<T> responseType, Map<String, ?> params) {
        return restTemplate.getForObject(url, responseType, params);
    }

    /**
     * GET 请求（带请求头）
     */
    public <T> T get(String url, HttpHeaders headers, Class<T> responseType) {
        HttpEntity<Void> entity = new HttpEntity<>(headers);
        ResponseEntity<T> response = restTemplate.exchange(url, HttpMethod.GET, entity, responseType);
        return response.getBody();
    }

    /**
     * POST 请求（JSON）
     */
    public <T> T postJson(String url, Object body, Class<T> responseType) {
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity<Object> entity = new HttpEntity<>(body, headers);
        return restTemplate.postForObject(url, entity, responseType);
    }

    /**
     * POST 请求（带请求头）
     */
    public <T> T postJson(String url, Object body, HttpHeaders headers, Class<T> responseType) {
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity<Object> entity = new HttpEntity<>(body, headers);
        return restTemplate.postForObject(url, entity, responseType);
    }

    /**
     * PUT 请求
     */
    public <T> T put(String url, Object body, Class<T> responseType) {
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        HttpEntity<Object> entity = new HttpEntity<>(body, headers);
        ResponseEntity<T> response = restTemplate.exchange(url, HttpMethod.PUT, entity, responseType);
        return response.getBody();
    }

    /**
     * DELETE 请求
     */
    public void delete(String url) {
        restTemplate.delete(url);
    }
}
```

### 7.2 RestTemplate 配置

```java
package com.{company}.{project}.common.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.client.SimpleClientHttpRequestFactory;
import org.springframework.web.client.RestTemplate;

@Configuration
public class RestTemplateConfig {

    @Bean
    public RestTemplate restTemplate() {
        SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();
        factory.setConnectTimeout(5000);
        factory.setReadTimeout(30000);
        return new RestTemplate(factory);
    }
}
```

---

## 8. 日志注解 @ApiLog

### 8.1 注解定义

```java
package com.{company}.{project}.common.aop;

import java.lang.annotation.*;

/**
 * 接口日志注解
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface ApiLog {

    /** 业务编码 */
    String bizCode() default "";

    /** 业务名称 */
    String bizName() default "";

    /** 是否记录请求参数 */
    boolean logParams() default true;

    /** 是否记录响应结果 */
    boolean logResult() default false;
}
```

### 8.2 日志切面

```java
package com.{company}.{project}.common.aop;

import cn.hutool.json.JSONUtil;
import jakarta.servlet.http.HttpServletRequest;
import lombok.extern.slf4j.Slf4j;
import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.reflect.MethodSignature;
import org.springframework.stereotype.Component;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

/**
 * 接口日志切面
 */
@Slf4j
@Aspect
@Component
public class ApiLogAspect {

    @Around("@annotation(apiLog)")
    public Object around(ProceedingJoinPoint point, ApiLog apiLog) throws Throwable {
        long startTime = System.currentTimeMillis();
        String bizCode = apiLog.bizCode();
        String bizName = apiLog.bizName();

        // 获取请求信息
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes != null ? attributes.getRequest() : null;
        String uri = request != null ? request.getRequestURI() : "";
        String method = request != null ? request.getMethod() : "";

        // 记录请求参数
        if (apiLog.logParams()) {
            Object[] args = point.getArgs();
            log.info("[{}] {} - 请求开始: {} {}, 参数: {}", bizCode, bizName, method, uri, JSONUtil.toJsonStr(args));
        } else {
            log.info("[{}] {} - 请求开始: {} {}", bizCode, bizName, method, uri);
        }

        Object result = null;
        try {
            result = point.proceed();
            long costTime = System.currentTimeMillis() - startTime;

            if (apiLog.logResult()) {
                log.info("[{}] {} - 请求成功: 耗时{}ms, 结果: {}", bizCode, bizName, costTime, JSONUtil.toJsonStr(result));
            } else {
                log.info("[{}] {} - 请求成功: 耗时{}ms", bizCode, bizName, costTime);
            }
            return result;
        } catch (Exception e) {
            long costTime = System.currentTimeMillis() - startTime;
            log.error("[{}] {} - 请求失败: 耗时{}ms, 异常: {}", bizCode, bizName, costTime, e.getMessage());
            throw e;
        }
    }
}
```

---

## 9. 登录用户上下文

### 9.1 LoginUser

```java
package com.{company}.{project}.common.web;

import lombok.Data;
import java.io.Serializable;

/**
 * 登录用户信息
 */
@Data
public class LoginUser implements Serializable {

    private static final long serialVersionUID = 1L;

    /** 用户ID */
    private Long userId;

    /** 用户名 */
    private String userName;
}
```

### 9.2 LoginUserHolder

```java
package com.{company}.{project}.common.web;

/**
 * 登录用户上下文（ThreadLocal）
 */
public class LoginUserHolder {

    private static final ThreadLocal<LoginUser> HOLDER = new ThreadLocal<>();

    private LoginUserHolder() {}

    public static void set(LoginUser loginUser) {
        HOLDER.set(loginUser);
    }

    public static LoginUser get() {
        return HOLDER.get();
    }

    public static Long getUserId() {
        LoginUser user = HOLDER.get();
        return user != null ? user.getUserId() : null;
    }

    public static String getUserName() {
        LoginUser user = HOLDER.get();
        return user != null ? user.getUserName() : null;
    }

    public static void clear() {
        HOLDER.remove();
    }
}
```

---

## 10. 常用工具类

### 10.1 AssertUtils 断言工具

```java
package com.{company}.{project}.common.util;

import com.{company}.{project}.common.core.ErrorCode;
import com.{company}.{project}.common.exception.BusinessException;
import cn.hutool.core.util.StrUtil;
import java.util.Collection;

/**
 * 断言工具类
 */
public class AssertUtils {

    private AssertUtils() {}

    public static void notNull(Object obj, ErrorCode errorCode) {
        if (obj == null) {
            throw new BusinessException(errorCode);
        }
    }

    public static void notNull(Object obj, ErrorCode errorCode, String message) {
        if (obj == null) {
            throw new BusinessException(errorCode, message);
        }
    }

    public static void notBlank(String str, ErrorCode errorCode) {
        if (StrUtil.isBlank(str)) {
            throw new BusinessException(errorCode);
        }
    }

    public static void notEmpty(Collection<?> collection, ErrorCode errorCode) {
        if (collection == null || collection.isEmpty()) {
            throw new BusinessException(errorCode);
        }
    }

    public static void isTrue(boolean expression, ErrorCode errorCode) {
        if (!expression) {
            throw new BusinessException(errorCode);
        }
    }

    public static void isTrue(boolean expression, ErrorCode errorCode, String message) {
        if (!expression) {
            throw new BusinessException(errorCode, message);
        }
    }
}
```

### 10.2 DateUtils 日期工具

```java
package com.{company}.{project}.common.util;

import java.time.*;
import java.time.format.DateTimeFormatter;

/**
 * 日期工具类
 */
public class DateUtils {

    private DateUtils() {}

    public static final String DATE_PATTERN = "yyyy-MM-dd";
    public static final String DATETIME_PATTERN = "yyyy-MM-dd HH:mm:ss";

    public static String formatDate(LocalDate date) {
        return date.format(DateTimeFormatter.ofPattern(DATE_PATTERN));
    }

    public static String formatDateTime(LocalDateTime dateTime) {
        return dateTime.format(DateTimeFormatter.ofPattern(DATETIME_PATTERN));
    }

    public static LocalDate parseDate(String dateStr) {
        return LocalDate.parse(dateStr, DateTimeFormatter.ofPattern(DATE_PATTERN));
    }

    public static LocalDateTime parseDateTime(String dateTimeStr) {
        return LocalDateTime.parse(dateTimeStr, DateTimeFormatter.ofPattern(DATETIME_PATTERN));
    }

    public static long toTimestamp(LocalDateTime dateTime) {
        return dateTime.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
    }

    public static LocalDateTime fromTimestamp(long timestamp) {
        return LocalDateTime.ofInstant(Instant.ofEpochMilli(timestamp), ZoneId.systemDefault());
    }
}
```

### 10.3 JsonUtils JSON工具

```java
package com.{company}.{project}.common.util;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import lombok.extern.slf4j.Slf4j;

/**
 * JSON 工具类
 */
@Slf4j
public class JsonUtils {

    private static final ObjectMapper MAPPER = new ObjectMapper();

    static {
        MAPPER.registerModule(new JavaTimeModule());
    }

    private JsonUtils() {}

    public static String toJson(Object obj) {
        try {
            return MAPPER.writeValueAsString(obj);
        } catch (Exception e) {
            log.error("JSON序列化失败", e);
            return null;
        }
    }

    public static <T> T fromJson(String json, Class<T> clazz) {
        try {
            return MAPPER.readValue(json, clazz);
        } catch (Exception e) {
            log.error("JSON反序列化失败", e);
            return null;
        }
    }

    public static <T> T fromJson(String json, TypeReference<T> typeRef) {
        try {
            return MAPPER.readValue(json, typeRef);
        } catch (Exception e) {
            log.error("JSON反序列化失败", e);
            return null;
        }
    }
}
```

---

## 11. 公共类目录结构

```
com.{company}.{project}.common/
├── aop/
│   ├── ApiLog.java              # 日志注解
│   └── ApiLogAspect.java        # 日志切面
├── config/
│   └── RestTemplateConfig.java  # RestTemplate配置
├── constant/
│   └── Constants.java           # 全局常量
├── core/
│   ├── R.java                   # 统一响应
│   └── ErrorCode.java           # 错误码
├── exception/
│   ├── BusinessException.java   # 业务异常
│   └── GlobalExceptionHandler.java  # 全局异常处理
├── redis/
│   ├── RedisKeys.java           # Redis Key常量
│   └── RedisUtils.java          # Redis工具类
├── util/
│   ├── AssertUtils.java         # 断言工具
│   ├── DateUtils.java           # 日期工具
│   ├── JsonUtils.java           # JSON工具
│   └── RestTemplateUtils.java   # HTTP请求工具
└── web/
    ├── LoginUser.java           # 登录用户
    └── LoginUserHolder.java     # 用户上下文
```
