# 代码模板规范

> 本文档提供标准代码模板，用于快速生成符合规范的 CRUD 代码。

## 文档版本

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-01-06 | 初始版本 |

---

## 1. 模板变量说明

| 变量 | 说明 | 示例 |
|------|------|------|
| `{project}` | 项目名称 | `order-system` |
| `{company}` | 公司/组织名 | `example` |
| `{module}` | 模块名（小写） | `user`, `order` |
| `{Entity}` | 实体类名（大驼峰） | `User`, `OrderItem` |
| `{entity}` | 实体变量名（小驼峰） | `user`, `orderItem` |
| `{table_name}` | 数据库表名 | `sys_user`, `order_item` |
| `{description}` | 中文描述 | `用户`, `订单项` |
| `{MODULE}` | 模块大写名 | `USER`, `ORDER` |

---

## 2. Entity 实体类模板

### 2.1 标准实体

```java
package com.{company}.{project}.{module}.entity;

import com.baomidou.mybatisplus.annotation.*;
import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serial;
import java.io.Serializable;
import java.util.Date;

/**
 * {description}实体
 *
 * @author {author}
 * @since {date}
 */
@Data
@TableName("{table_name}")
@Schema(description = "{description}")
public class {Entity} implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    @TableId(type = IdType.AUTO)
    @Schema(description = "主键ID")
    private Long id;

    // ========== 业务字段 ==========

    @Schema(description = "名称")
    private String name;

    @Schema(description = "状态 (1-启用, 0-禁用)")
    private Integer status;

    // ========== 通用字段 ==========
    @Schema(description = "创建人")
    private String createBy;
    
    @TableField(fill = FieldFill.INSERT)
    @Schema(description = "创建时间")
    private Date createTime;

    @TableField(fill = FieldFill.UPDATE)
    @Schema(description = "更新时间")
    private Date updateTime;
    
    @Schema(description = "更新人")
    private String updateBy;
    
    @TableLogic
    @Schema(description = "删除标记")
    private Integer delFlag;
}
```

---

## 3. Mapper 模板

### 3.1 Mapper 接口

```java
package com.{company}.{project}.{module}.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.{company}.{project}.{module}.entity.{Entity};
import org.apache.ibatis.annotations.Mapper;

/**
 * {description} Mapper
 *
 * @author {author}
 * @since {date}
 */
@Mapper
public interface {Entity}Mapper extends BaseMapper<{Entity}> {

}
```

### 3.2 Mapper XML

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.{company}.{project}.{module}.mapper.{Entity}Mapper">

    <resultMap id="BaseResultMap" type="com.{company}.{project}.{module}.entity.{Entity}">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="status" column="status"/>
        <result property="delFlag" column="del_flag"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, name, status,del_flag, create_by, update_by, create_time, update_time
    </sql>

</mapper>
```

---

## 4. DTO 模板

### 4.1 创建请求 DTO

```java
package com.{company}.{project}.{module}.model.request;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;
import lombok.Data;
import java.io.Serial;
import java.io.Serializable;

/**
 * {description}创建请求
 */
@Data
@Schema(description = "{description}创建请求")
public class {Entity}CreateRequest implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    @NotBlank(message = "名称不能为空")
    @Size(max = 100, message = "名称长度不能超过100")
    @Schema(description = "名称", requiredMode = Schema.RequiredMode.REQUIRED)
    private String name;

    @Schema(description = "状态", defaultValue = "1")
    private Integer status = 1;
}
```

### 4.2 更新请求 DTO

```java
package com.{company}.{project}.{module}.model.request;

import io.swagger.v3.oas.annotations.media.Schema;
import jakarta.validation.constraints.NotNull;
import lombok.Data;
import java.io.Serial;
import java.io.Serializable;

/**
 * {description}更新请求
 */
@Data
@Schema(description = "{description}更新请求")
public class {Entity}UpdateRequest implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    @Schema(description = "名称")
    private String name;

    @Schema(description = "状态")
    private Integer status;
}
```

### 4.3 查询请求 DTO

```java
package com.{company}.{project}.{module}.model.request;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serial;
import java.io.Serializable;

/**
 * {description}查询请求
 */
@Data
@Schema(description = "{description}查询请求")
public class {Entity}QueryRequest implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    @Schema(description = "页码", defaultValue = "1")
    private Integer pageNo = 1;

    @Schema(description = "每页数量", defaultValue = "10")
    private Integer pageSize = 10;

    @Schema(description = "关键词")
    private String keyword;

    @Schema(description = "状态")
    private Integer status;
}
```

### 4.4 响应 DTO

```java
package com.{company}.{project}.{module}.model.response;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import java.io.Serial;
import java.io.Serializable;
import java.util.Date;

/**
 * {description}响应
 */
@Data
@Schema(description = "{description}响应")
public class {Entity}Response implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    @Schema(description = "主键ID")
    private Long id;

    @Schema(description = "名称")
    private String name;

    @Schema(description = "状态")
    private Integer status;

    @Schema(description = "创建时间")
    private Date createTime;

    @Schema(description = "更新时间")
    private Date updateTime;
}
```

---

## 5. Service 模板

### 5.1 Service 接口

```java
package com.{company}.{project}.{module}.service;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.service.IService;
import com.{company}.{project}.{module}.model.request.*;
import com.{company}.{project}.{module}.model.response.{Entity}Response;
import com.{company}.{project}.{module}.entity.{Entity};
import java.util.List;

/**
 * {description}服务接口
 */
public interface {Entity}Service extends IService<{Entity}> {

    /**
     * 创建
     */
    Long create({Entity}CreateRequest request);

    /**
     * 更新
     */
    void update(Long id, {Entity}UpdateRequest request);

    /**
     * 删除
     */
    void deleteById(Long id);

    /**
     * 根据ID获取详情
     */
    {Entity}Response getDetail(Long id);

    /**
     * 列表查询（不分页）
     */
    List<{Entity}Response> list({Entity}QueryRequest request);

    /**
     * 分页查询
     */
    IPage<{Entity}Response> pageQuery({Entity}QueryRequest request);
}
```

### 5.2 Service 实现类

```java
package com.{company}.{project}.{module}.service.impl;

import cn.hutool.core.util.StrUtil;
import com.baomidou.mybatisplus.core.metadata.IPage;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.{company}.{project}.common.core.ErrorCode;
import com.{company}.{project}.common.exception.BusinessException;
import com.{company}.{project}.{module}.model.request.*;
import com.{company}.{project}.{module}.model.response.{Entity}Response;
import com.{company}.{project}.{module}.entity.{Entity};
import com.{company}.{project}.{module}.mapper.{Entity}Mapper;
import com.{company}.{project}.{module}.service.{Entity}Service;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.BeanUtils;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;
import java.util.stream.Collectors;

/**
 * {description}服务实现类
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class {Entity}ServiceImpl extends ServiceImpl<{Entity}Mapper, {Entity}>
        implements {Entity}Service {

    @Override
    @Transactional(rollbackFor = Exception.class)
    public Long create({Entity}CreateRequest request) {
        // 1. 业务校验（按需添加）
        // 例如：检查名称是否重复
        // boolean exists = lambdaQuery().eq({Entity}::getName, request.getName()).exists();
        // if (exists) {
        //     throw new BusinessException(ErrorCode.DATA_EXIST, "名称已存在");
        // }

        // 2. 构建实体
        {Entity} entity = new {Entity}();
        BeanUtils.copyProperties(request, entity);

        // 3. 保存
        this.save(entity);
        log.info("[{Entity}ServiceImpl.create] {description}创建成功, id={}", entity.getId());

        return entity.getId();
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void update(Long id, {Entity}UpdateRequest request) {
        // 1. 检查是否存在
        {Entity} entity = this.getById(id);
        if (entity == null) {
            throw new BusinessException(ErrorCode.NOT_FOUND);
        }

        // 2. 更新字段（非空才更新）
        if (StrUtil.isNotBlank(request.getName())) {
            entity.setName(request.getName());
        }
        if (request.getStatus() != null) {
            entity.setStatus(request.getStatus());
        }

        // 3. 保存
        this.updateById(entity);
        log.info("[{Entity}ServiceImpl.update] {description}更新成功, id={}", entity.getId());
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void deleteById(Long id) {
        // 1. 检查是否存在
        {Entity} entity = this.getById(id);
        if (entity == null) {
            throw new BusinessException(ErrorCode.NOT_FOUND);
        }

        // 2. 删除（逻辑删除）
        this.removeById(id);
        log.info("[{Entity}ServiceImpl.deleteById] {description}删除成功, id={}", id);
    }

    @Override
    public {Entity}Response getDetail(Long id) {
        {Entity} entity = this.getById(id);
        if (entity == null) {
            throw new BusinessException(ErrorCode.NOT_FOUND);
        }
        return convertToResponse(entity);
    }

    @Override
    public List<{Entity}Response> list({Entity}QueryRequest request) {
        List<{Entity}> list = this.lambdaQuery()
                .like(StrUtil.isNotBlank(request.getKeyword()), {Entity}::getName, request.getKeyword())
                .eq(request.getStatus() != null, {Entity}::getStatus, request.getStatus())
                .orderByDesc({Entity}::getCreateTime)
                .list();

        return list.stream().map(this::convertToResponse).collect(Collectors.toList());
    }

    @Override
    public IPage<{Entity}Response> pageQuery({Entity}QueryRequest request) {
    Page<{Entity}> page = new Page<>(request.getPageNo(), request.getPageSize());

        IPage<{Entity}> entityPage = this.lambdaQuery()
                .like(StrUtil.isNotBlank(request.getKeyword()), {Entity}::getName, request.getKeyword())
                .eq(request.getStatus() != null, {Entity}::getStatus, request.getStatus())
                .orderByDesc({Entity}::getCreateTime)
                .page(page);

        return entityPage.convert(this::convertToResponse);
    }

    /**
     * 实体转响应DTO
     */
    private {Entity}Response convertToResponse({Entity} entity) {
        {Entity}Response response = new {Entity}Response();
        BeanUtils.copyProperties(entity, response);
        return response;
    }
}
```

---

## 6. Controller 模板

### 6.1 Web 管理后台 Controller（完整CRUD）

```java
package com.{company}.{project}.admin.controller;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.{company}.{project}.common.aop.ApiLog;
import com.{company}.{project}.common.core.R;
import com.{company}.{project}.{module}.model.request.*;
import com.{company}.{project}.{module}.model.response.{Entity}Response;
import com.{company}.{project}.{module}.service.{Entity}Service;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import java.util.List;

/**
 * {description}管理 - Web后台接口
 */
@Tag(name = "{description}管理")
@RestController
@RequestMapping("/{project}/web/v1/{module}")
@RequiredArgsConstructor
public class {Entity}Controller {

    private final {Entity}Service {entity}Service;

    @Operation(summary = "创建{description}")
    @ApiLog(bizCode = "{MODULE}_CREATE", bizName = "创建{description}")
    @PostMapping
    public R<Long> create(@RequestBody @Validated {Entity}CreateRequest request) {
        Long id = {entity}Service.create(request);
        return R.success(id);
    }

    @Operation(summary = "更新{description}")
    @ApiLog(bizCode = "{MODULE}_UPDATE", bizName = "更新{description}")
    @PutMapping("/{id}")
    public R<Void> update(
            @Parameter(description = "ID") @PathVariable Long id,
            @RequestBody @Validated {Entity}UpdateRequest request) {
        {entity}Service.update(id, request);
        return R.success();
    }

    @Operation(summary = "删除{description}")
    @ApiLog(bizCode = "{MODULE}_DELETE", bizName = "删除{description}")
    @DeleteMapping("/{id}")
    public R<Void> delete(@Parameter(description = "ID") @PathVariable Long id) {
        {entity}Service.deleteById(id);
        return R.success();
    }

    @Operation(summary = "获取{description}详情")
    @GetMapping("/{id}")
    public R<{Entity}Response> detail(@Parameter(description = "ID") @PathVariable Long id) {
        {Entity}Response response = {entity}Service.getDetail(id);
        return R.success(response);
    }

    @Operation(summary = "{description}列表（不分页）")
    @GetMapping
    public R<List<{Entity}Response>> list(@Validated {Entity}QueryRequest request) {
        List<{Entity}Response> list = {entity}Service.list(request);
        return R.success(list);
    }

    @Operation(summary = "{description}分页列表")
    @GetMapping(params = "pageNo")
    public R<IPage<{Entity}Response>> page(@Validated {Entity}QueryRequest request) {
        IPage<{Entity}Response> page = {entity}Service.pageQuery(request);
        return R.success(page);
    }
}
```

### 6.2 App/小程序端 Controller

```java
package com.{company}.{project}.api.controller;

import com.{company}.{project}.common.aop.ApiLog;
import com.{company}.{project}.common.core.R;
import com.{company}.{project}.common.web.LoginUser;
import com.{company}.{project}.common.web.LoginUserHolder;
import com.{company}.{project}.{module}.model.request.*;
import com.{company}.{project}.{module}.model.response.{Entity}Response;
import com.{company}.{project}.{module}.service.{Entity}Service;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import java.util.List;

/**
 * {description} - App端接口
 */
@Tag(name = "{description}")
@RestController
@RequestMapping("/{project}/api/v1/{module}")
@RequiredArgsConstructor
public class {Entity}AppController {

    private final {Entity}Service {entity}Service;

    @Operation(summary = "获取{description}列表")
    @GetMapping
    public R<List<{Entity}Response>> list(@Validated {Entity}QueryRequest request) {
        LoginUser loginUser = LoginUserHolder.get();
        // 可根据登录用户过滤数据
        List<{Entity}Response> list = {entity}Service.list(request);
        return R.success(list);
    }

    @Operation(summary = "获取{description}详情")
    @GetMapping("/{id}")
    public R<{Entity}Response> detail(@PathVariable Long id) {
        {Entity}Response response = {entity}Service.getDetail(id);
        return R.success(response);
    }

    @Operation(summary = "创建{description}")
    @ApiLog(bizCode = "{MODULE}_CREATE", bizName = "创建{description}")
    @PostMapping
    public R<Long> create(@RequestBody @Validated {Entity}CreateRequest request) {
        Long id = {entity}Service.create(request);
        return R.success(id);
    }
}
```

---

## 7. 数据库表模板

### 7.1 标准业务表

```sql
-- {description}表
CREATE TABLE `{table_name}` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `name` VARCHAR(100) NOT NULL COMMENT '名称',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态 (1-启用, 0-禁用)',
    `create_by` VARCHAR(64) NOT NULL COMMENT '创建人',
    `update_by` VARCHAR(64) COMMENT '更新人',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME COMMENT '更新时间',
    `del_flag` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '删除标记 (0-未删除, 1-已删除)',
    PRIMARY KEY (`id`),
    INDEX `idx_status` (`status`),
    INDEX `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='{description}';
```

### 7.2 用户关联表

```sql
-- {description}表（用户关联）
CREATE TABLE `{table_name}` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
    `user_id` BIGINT NOT NULL COMMENT '用户ID',
    `name` VARCHAR(100) NOT NULL COMMENT '名称',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态',
    `create_by` VARCHAR(64) NOT NULL COMMENT '创建人',
    `update_by` VARCHAR(64) COMMENT '更新人',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME COMMENT '更新时间',
    `del_flag` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '删除标记',
    PRIMARY KEY (`id`),
    INDEX `idx_user_id` (`user_id`),
    INDEX `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='{description}';
```

---

## 8. 使用示例

### 8.1 创建用户模块

将模板中的变量替换为：

| 变量 | 值 |
|------|-----|
| `{company}` | `example` |
| `{project}` | `demo` |
| `{module}` | `user` |
| `{Entity}` | `User` |
| `{entity}` | `user` |
| `{table_name}` | `sys_user` |
| `{description}` | `用户` |
| `{MODULE}` | `USER` |

### 8.2 生成的文件清单

```
com.example.demo.user/
├── entity/
│   └── User.java
├── mapper/
│   └── UserMapper.java
├── service/
│   ├── UserService.java
│   └── impl/
│       └── UserServiceImpl.java
├── dto/
│   ├── request/
│   │   ├── UserCreateRequest.java
│   │   ├── UserUpdateRequest.java
│   │   └── UserQueryRequest.java
│   └── response/
│       └── UserResponse.java

com.example.demo.admin.controller/
└── UserController.java

com.example.demo.api.controller/
└── UserAppController.java

resources/mapper/
└── UserMapper.xml
```
