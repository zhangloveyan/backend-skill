# AI 辅助开发指南

> 本文档是 Claude/AI 辅助开发的专用指南，定义 AI 在项目中的开发规范和工作流程。

## 文档版本

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2025-01-06 | 初始版本 |

---

## 1. 项目上下文模板

使用前请填写项目信息：

```yaml
# 项目信息
项目名称: {project-name}
项目路径: {project-path}
基础包名: com.{company}.{project}

# 技术栈
Java版本: 17
Spring Boot: 3.x
ORM框架: MyBatis-Plus 3.5.x
API文档: Knife4j 4.x
数据库: MySQL 8.0
缓存: Redis 7.x

# 模块结构
{project}-common/    # 通用模块
{project}-core/      # 业务核心
{project}-admin/     # 管理后台 (端口 9501)
{project}-api/       # 对外接口 (端口 9502)
```

---

## 2. 规范文档索引

| 文档 | 路径 | 用途 |
|------|------|------|
| 项目规范总览 | `docs/00-项目规范总览.md` | 项目整体规范 |
| 开发规范 | `docs/01-开发规范.md` | 数据库/日志/注释/安全/Git规范 |
| 接口规范 | `docs/02-接口规范.md` | URL格式/端类型/响应格式 |
| 代码模板 | `docs/03-代码模板.md` | CRUD 代码模板 |
| 公共类规范 | `docs/04-公共类规范.md` | R类/异常/Redis/工具类 |
| Docker部署 | `docs/05-Docker部署.md` | 部署配置 |

---

## 3. AI 开发工作流

### 3.1 接收需求时

```
1. 理解需求
   ├── 阅读需求描述
   ├── 确认功能边界
   └── 识别涉及的模块

2. 查阅规范
   ├── 检查接口规范是否已定义相关接口
   ├── 检查是否有现有代码可复用
   └── 确认命名规范

3. 制定计划
   ├── 列出需要创建/修改的文件
   ├── 确定开发顺序
   └── 识别潜在风险点
```

### 3.2 代码生成顺序

```
1. 数据库层 → 创建/修改表结构
2. Entity   → 创建实体类
3. Mapper   → 创建 Mapper 接口 + XML
4. Service  → 创建 Service 接口 + 实现类
5. DTO      → 创建 Request/Response DTO
6. Controller → 创建 Controller
7. 文档     → 更新相关文档
```

---

## 4. 命名规范速查

### 4.1 类命名

| 类型 | 规则 | 示例 |
|------|------|------|
| Entity | 大驼峰，单数 | `User`, `OrderItem` |
| Mapper | Entity + Mapper | `UserMapper` |
| Service | Entity + Service | `UserService` |
| ServiceImpl | Entity + ServiceImpl | `UserServiceImpl` |
| Controller | Entity + Controller | `UserController` |
| CreateRequest | Entity + CreateRequest | `UserCreateRequest` |
| UpdateRequest | Entity + UpdateRequest | `UserUpdateRequest` |
| QueryRequest | Entity + QueryRequest | `UserQueryRequest` |
| Response | Entity + Response | `UserResponse` |

### 4.2 包路径

```
com.{company}.{project}.{module}.entity.{Entity}
com.{company}.{project}.{module}.mapper.{Entity}Mapper
com.{company}.{project}.{module}.service.{Entity}Service
com.{company}.{project}.{module}.service.impl.{Entity}ServiceImpl
com.{company}.{project}.{module}.dto.request.{Entity}CreateRequest
com.{company}.{project}.{module}.dto.response.{Entity}Response
com.{company}.{project}.admin.controller.{Entity}Controller
com.{company}.{project}.api.controller.{Entity}AppController
```

### 4.3 接口路径

```
/{project}/{端类型}/v{版本}/{模块}/{资源}/{操作}

端类型: web | api | open | callback | internal
操作: create | update | delete | detail | list | page
```

### 4.4 数据库命名

| 类型 | 规则 | 示例 |
|------|------|------|
| 表名 | 小写下划线，单数 | `sys_user`, `order_item` |
| 字段名 | 小写下划线 | `user_id`, `create_time` |
| 主键 | id | `id` |
| 外键 | 关联表_id | `user_id`, `order_id` |

---

## 5. 常用代码片段

### 5.1 分页查询

```java
@Override
public IPage<{Entity}Response> pageQuery({Entity}QueryRequest request) {
    Page<{Entity}> page = new Page<>(request.getPageNum(), request.getPageSize());

    IPage<{Entity}> entityPage = this.lambdaQuery()
            .like(StrUtil.isNotBlank(request.getKeyword()), {Entity}::getName, request.getKeyword())
            .eq(request.getStatus() != null, {Entity}::getStatus, request.getStatus())
            .orderByDesc({Entity}::getCreateTime)
            .page(page);

    return entityPage.convert(this::convertToResponse);
}
```

### 5.2 获取登录用户

```java
LoginUser loginUser = LoginUserHolder.get();
Long userId = loginUser.getUserId();
```

### 5.3 事务处理

```java
@Override
@Transactional(rollbackFor = Exception.class)
public void complexOperation() {
    // 多个数据库操作
}
```

### 5.4 业务校验

```java
// 使用 AssertUtils
AssertUtils.notNull(entity, ErrorCode.NOT_FOUND);
AssertUtils.isTrue(condition, ErrorCode.PARAM_ERROR, "自定义消息");

// 使用 BusinessException
if (entity == null) {
    throw new BusinessException(ErrorCode.NOT_FOUND);
}
```

### 5.5 Redis 缓存

```java
// 设置缓存
redisUtils.set(RedisKeys.USER_INFO + userId, JsonUtils.toJson(user), Constants.CACHE_1_HOUR);

// 获取缓存
String json = redisUtils.get(RedisKeys.USER_INFO + userId);
User user = JsonUtils.fromJson(json, User.class);

// 删除缓存
redisUtils.delete(RedisKeys.USER_INFO + userId);
```

### 5.6 HTTP 请求

```java
// GET 请求
String result = restTemplateUtils.get(url, String.class);

// POST 请求
Response response = restTemplateUtils.postJson(url, requestBody, Response.class);
```

---

## 6. 开发检查清单

### 6.1 新功能开发

```
□ Entity 类包含所有必要字段和注解
□ Mapper XML 已创建
□ Service 接口定义完整（create/update/delete/getDetail/list/pageQuery）
□ ServiceImpl 实现完整，包含参数校验和日志
□ DTO 包含必要的校验注解（@NotNull, @NotBlank, @Size 等）
□ Controller 添加 @ApiLog 注解
□ Controller 添加 Swagger 注解（@Tag, @Operation, @Parameter）
□ 接口路径符合规范
□ 错误码使用 ErrorCode 枚举
□ 日志使用占位符格式
```

### 6.2 代码质量

```
□ 无硬编码的字符串/数字（使用 Constants）
□ 无未处理的异常
□ 无 SQL 注入风险
□ 无敏感信息泄露
□ 方法职责单一
□ 代码可读性良好
```

---

## 7. 指令模板

### 7.1 创建新模块

```
请按照项目规范创建 {模块名} 模块：

表名: {table_name}
字段:
- id: 主键
- name: 名称 VARCHAR(100)
- status: 状态 TINYINT (1-启用, 0-禁用)
- ...

需要的接口:
- Web后台: 列表、详情、创建、更新、删除
- App端: 列表、详情

请参考 docs/03-代码模板.md 生成代码。
```

### 7.2 添加新接口

```
请在 {模块名} 模块添加新接口：

接口: {HTTP方法} /{project}/{端类型}/v1/{module}/{path}
功能: {功能描述}
参数: {参数列表}
返回: {返回数据}

请遵循 docs/02-接口规范.md。
```

### 7.3 修复 Bug

```
问题描述: {问题描述}
复现步骤: {复现步骤}
期望行为: {期望行为}
相关文件: {文件路径}

请定位问题并修复。
```

### 7.4 代码重构

```
请重构 {文件路径} 中的 {方法/类}：

当前问题: {问题描述}
期望效果: {期望效果}

请保持功能不变，提升代码质量。
```

---

## 8. 常见问题处理

### 8.1 Mapper 找不到

确保 Mapper 接口添加了 `@Mapper` 注解，或在启动类添加 `@MapperScan`。

### 8.2 事务不生效

- 方法必须是 `public`
- 添加 `@Transactional(rollbackFor = Exception.class)`
- 异常不能被 catch 吞掉

### 8.3 JSON 字段处理

```java
// Entity
@TableField(typeHandler = JacksonTypeHandler.class)
private List<String> tags;

// Mapper XML
<result column="tags" property="tags"
    typeHandler="com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler"/>
```

### 8.4 枚举字段处理

```java
// 枚举类
@Getter
@AllArgsConstructor
public enum StatusEnum {
    ENABLE(1, "启用"),
    DISABLE(0, "禁用");

    @EnumValue
    private final Integer code;
    private final String desc;
}

// Entity
private StatusEnum status;
```

---

## 9. 版本控制

### 9.1 分支策略

```
master/main  - 生产分支
develop      - 开发分支
feature/*    - 功能分支
bugfix/*     - 修复分支
```

### 9.2 提交信息格式

```
<type>: <subject>

type: feat | fix | docs | style | refactor | test | chore
```

**示例**：
```
feat: 添加用户管理模块
fix: 修复登录token过期问题
docs: 更新接口文档
```

---

## 10. Task 文档规范

### 10.1 Task 文档位置

```
docs/TASK.md
```

说明：该文件为模板/示例，实际任务按模板新增任务块。

### 10.2 Task 文档格式

```markdown
## {日期} {功能名称}

### 任务背景
简要描述任务背景和目标

### 任务清单
- [ ] 任务项1
- [ ] 任务项2
- [x] 已完成任务

### 提交记录
- `{commit-hash}` {type}: {message}
```

### 10.3 开发流程

```
1. 需求分析
   ├── 理解需求
   ├── 确认功能边界
   └── 识别涉及模块

2. 创建 Task 文档
   ├── 记录任务背景
   ├── 拆分任务清单
   └── 标记任务状态

3. 逐项开发
   ├── 标记当前任务为进行中
   ├── 完成代码开发
   ├── 标记任务完成
   └── Git 提交

4. 更新 Task 文档
   ├── 记录提交信息
   └── 更新任务状态

5. 循环直到所有任务完成
```

### 10.4 Task 状态标记

| 标记 | 状态 |
|------|------|
| `[ ]` | 待完成 |
| `[x]` | 已完成 |
| `[-]` | 已取消 |
| `[!]` | 阻塞中 |

### 10.5 示例

```markdown
## 2025-01-07 用户模块开发

### 任务背景
实现用户管理功能，包括用户的增删改查和登录认证。

### 任务清单
- [x] 创建 User Entity
- [x] 创建 UserMapper + XML
- [x] 创建 UserService 接口
- [x] 创建 UserServiceImpl 实现
- [ ] 创建 UserController
- [ ] 创建 DTO (Request/Response)
- [ ] 编写单元测试

### 提交记录
- `a1b2c3d` feat: 添加用户实体类
- `e4f5g6h` feat: 添加用户Mapper和XML
- `i7j8k9l` feat: 添加用户Service层
```

---

## 11. 总结

AI 在项目开发时应：

1. **始终参考规范文档** - 生成代码前先查阅相关规范
2. **使用标准模板** - 按照代码模板生成代码
3. **遵循命名规范** - 包名、类名、方法名、接口路径符合规范
4. **保持代码一致性** - 与现有代码风格保持一致
5. **进行自检** - 使用检查清单确保代码质量
6. **维护 Task 文档** - 开发前创建任务清单，完成后更新状态
7. **及时提交代码** - 每完成一个功能点进行 Git 提交
8. **更新相关文档** - 完成开发后更新接口文档和进度
